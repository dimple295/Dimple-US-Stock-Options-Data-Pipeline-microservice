events {}

http {
    # Upstream definitions for each cluster
    upstream cluster_a_ingress {
        server 172.18.0.3:80;  # Replace with cluster-a-control-plane IP
    }

    upstream cluster_b_ingress {
        server 172.18.0.8:30080;  # Replace with cluster-b-control-plane IP
    }

    server {
        listen 80;

        ######## Cluster A ########
        location /cluster-a/data-collector/ {
            proxy_pass http://cluster_a_ingress/data-collector/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/data-api/ {
            proxy_pass http://cluster_a_ingress/data-api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/data-processor/ {
            proxy_pass http://cluster_a_ingress/data-processor/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/database-writer/ {
            proxy_pass http://cluster_a_ingress/database-writer/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/file-writer/ {
            proxy_pass http://cluster_a_ingress/file-writer/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/grafana/ {
            proxy_pass http://cluster_a_ingress/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-a/prometheus/ {
            proxy_pass http://cluster_a_ingress/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        ######## Cluster B ########
        location /cluster-b/data-collector/ {
            proxy_pass http://cluster_b_ingress/data-collector/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/data-api/ {
            proxy_pass http://cluster_b_ingress/data-api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/data-processor/ {
            proxy_pass http://cluster_b_ingress/data-processor/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/database-writer/ {
            proxy_pass http://cluster_b_ingress/database-writer/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/file-writer/ {
            proxy_pass http://cluster_b_ingress/file-writer/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/grafana/ {
            proxy_pass http://cluster_b_ingress/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        location /cluster-b/prometheus/ {
            proxy_pass http://cluster_b_ingress/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        ######## Default route (Cluster A fallback) ########
        location / {
            proxy_pass http://cluster_a_ingress;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
